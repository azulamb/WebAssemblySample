<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>Hello, World!(WASI)</title>
<script>

document.addEventListener( 'DOMContentLoaded', () => {
	const result = document.getElementById( 'result' );

	const importObject = {
		wasi_unstable: {
			fd_write: ( fd, iovs, iovs_len, nwritten ) => {
				console.log( fd, iovs, iovs_len, nwritten );
				return 0;
			},
		},
	};
	// TypeError: WebAssembly.instantiate(): Import #0 module="wasi_unstable" error: module is not an object or function
	//WebAssembly.instantiateStreaming( fetch( './hello.wasm' ), {} ).then( ( wasm ) => {
	WebAssembly.instantiateStreaming( fetch( './hello.wasm' ), importObject ).then( ( wasm ) => {
		console.log( wasm );
		importObject.wasi_unstable.fd_write = () => { console.log( 'test' ); return 0; };
		wasm.instance.exports._start();
	} ).catch( ( error ) => { console.log( error ); } );
} );
</script>
<style>
</style>
</head>
<body>
	<div>
		<input id="result" readonly />
	</div>
</body>
</html>
